# zig-os-windows

Complete Autogenerated Zig bindings for Windows.

## Goals

Users should be able to take a Windows C/C++ example and port it to Zig without changing any names or the way it interfaces with the Windows API.  This means the autogenerated bindings need to:

* Support a set of modules with the same structure as the Window headers.  Importing the `windows` module should have all the same declarations as the `windows.h` header.
* Generate structs with the same field names (hungarian notation)
* Support code that can be compiled for either Ascii or Wide characters.  Provide mappings like `CreateFile` to `CreateFileA` or `CreateFileW` based on this configuration.

In addition:

* Along with generating the C/C++ style bindings, I may also want to generate the same bindings but using Zig styles.  For example, intead of `DWORD` or `UINT32`, I would generate `u32`.  Instead of field names with hungarian notation, I would generate them with snake case.  These would only be cosmetic changes, where it would look more natural to use the Windows API directly alongside other Zig APIs.  The bigger advantage to this is not having to track all the different ways to declare the same type, for example, a developer having to know that `DWORD`, `UINT32`, `ULONG`, `UINT` are all the same as `u32`.
* I may want to be able support different "views" into the api that change things like how to import the api.  These extra views should not add to compile-time unless they are being used.
* I may want to consider also generating wrapper APIs?  It's clear that wrapping APIs should exist, but I'm not sure if this wrapping API should be created/maintained manually or autogenerated from the Windows API data.
* I may want to make it possible to generate subsets of the complete API.  One example of where this could be used it to generate bindings to be included in the standard library, where only a small portion of the complete API is required.

## How to generate the Windows zig bindings

I'm currently using this MIT licensed database of the Windows sdk:

https://github.com/ohjeongwook/windows_sdk_data

However, this repository has over a dozen issues, including missing many functions, not including non-enum constants, inconsistencies in the JSON schema, etc.  The complete Windows API is huge, this repo has 327 json files with almost 4 million lines!  I'm not sure yet if I'll stick with this repo and try to fix the issues, try another repo, or try to write API scraping to generate this data myself.  I'd like to see how this repo owner generated these JSON files and build from there if possible. 

> There is also this repo (https://github.com/vadimkotov/winapi-json) but it currently has a GPL-3.0 license which makes it a non-starter, I've opened an issue asking if he would be willing to change it: https://github.com/vadimkotov/winapi-json/issues/3.

```
cd THIS_REPO
git clone https://github.com/ohjeongwook/windows_sdk_data
zig build
./zig-cache/bin/codegen
```

This will generate the bindings in the "out" directory.  The file `out/windows.zig` is the main package file.  It will contain pub imports to all sub modules in the "windows" directory.  It will also contain a special pub symbol `everything` that provides direct access to all symbols in the Windows SDK through a single namespace.

### Extra Json Files

* `missing.json`: contains stuff that is missing from the windows_sdk_data repo
* `fixed.json`: contains stuff that is filtered from windows_sdk_data repo and is fixed

## Next Idea

Try generating the Windows API data by including the windows headers inside a zig program and using comptime reflection.  Ive included `winreflector.zig` to experiment with.

```batch
zig run winreflector.zig -lc
```

There are currently bugs in zig translate C that prevent this from getting off the ground.

## TODO

* use in/out parameter information to add const to pointer types
* would be nice to generate proper Zig pointer types (i.e. instead of `[*c]T`, `*T` or `[*]T`)
